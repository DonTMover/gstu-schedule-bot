#!/bin/bash

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

IMAGE_NAME="gstu-bot"

echo "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
git pull

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker-compose down

echo "üßπ –û—á–∏—Å—Ç–∫–∞ dangling-–æ–±—Ä–∞–∑–æ–≤..."

# echo "üìä –î–æ –æ—á–∏—Å—Ç–∫–∏:"
# docker system df

docker image prune -f

# echo "üìä –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:"
# docker system df
# –Ω–∞ —ç—Ç–æ–º –º–æ–º–µ–Ω—Ç–µ –∑–∞–ª–∞–≥–∏–≤–∞–µ—Ç


echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)..."
# docker rmi $IMAGE_NAME  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑

echo "üîß –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞: $IMAGE_NAME"
docker build -t $IMAGE_NAME .

echo "üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose"
docker-compose up -d

echo "‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!"

